# Event System

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [alacritty/src/config/bindings.rs](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/config/bindings.rs)
- [alacritty/src/config/mod.rs](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/config/mod.rs)
- [alacritty/src/config/window.rs](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/config/window.rs)
- [alacritty/src/display/mod.rs](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/display/mod.rs)
- [alacritty/src/display/window.rs](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/display/window.rs)
- [alacritty/src/event.rs](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs)
- [alacritty/src/logging.rs](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/logging.rs)
- [alacritty/src/main.rs](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/main.rs)
- [alacritty/src/window_context.rs](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/window_context.rs)

</details>



The Alacritty Event System handles input processing, window management, and terminal state updates. It bridges user interactions (keyboard, mouse, window operations) with terminal operations by processing events and dispatching actions to the appropriate components. This page explains how events flow through the Alacritty codebase, from user input to terminal state changes.

For information about key and mouse bindings configuration, see [Key and Mouse Bindings](#4.1).

## Overview of the Event System

Alacritty's event system is centered around an event loop that processes various types of events: window events from the windowing system, terminal events from the PTY, and internally generated events like timer callbacks. The system dispatches these events to the appropriate terminal window and performs the requested actions.

### Event System High-Level Flow

```mermaid
flowchart TD
    A["User Input (Keyboard/Mouse)"] --> B["Winit Event Loop"]
    B --> C["Event Processor"]
    C --> D["Window Context"]
    
    E["Terminal Events (PTY)"] --> C
    F["Timer Events"] --> C
    G["Config Changes"] --> C
    
    D --> H["Input Processor"]
    H --> I["Action Context"]
    I --> J["Terminal State"]
    I --> K["Display"]
    
    subgraph "Event Processing"
        C
        D
        H
        I
    end
    
    subgraph "Event Sources"
        A
        E
        F
        G
    end
    
    subgraph "Terminal Interface"
        J
        K
    end
```

Sources: [alacritty/src/event.rs:75-91](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L75-L91), [alacritty/src/window_context.rs:47-68](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/window_context.rs#L47-L68), [alacritty/src/main.rs:135-137](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/main.rs#L135-L137)

## Event System Components

The event system consists of several key components that work together to process and handle events.

### Core Components

```mermaid
classDiagram
    class Processor {
        +config_monitor: ConfigMonitor
        +windows: HashMap<WindowId, WindowContext>
        +scheduler: Scheduler
        +handle_event()
        +run()
    }
    
    class Event {
        +window_id: Option<WindowId>
        +payload: EventType
    }
    
    class EventType {
        +Terminal(TerminalEvent)
        +ConfigReload(PathBuf)
        +Message(Message)
        +Scroll(Scroll)
        +CreateWindow(WindowOptions)
        +IpcConfig(IpcConfig)
        +BlinkCursor
        +SearchNext
        +Frame
    }
    
    class WindowContext {
        +display: Display
        +terminal: Term<EventProxy>
        +message_buffer: MessageBuffer
        +handle_event()
        +draw()
    }
    
    class ActionContext {
        +terminal: Term<T>
        +clipboard: Clipboard
        +display: Display
        +mouse: Mouse
        +write_to_pty()
        +scroll()
        +copy_selection()
    }
    
    Processor --> "many" WindowContext : manages
    WindowContext --> ActionContext : creates
    Processor --> Event : processes
    Event --> EventType : contains
```

Sources: [alacritty/src/event.rs:75-91](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L75-L91), [alacritty/src/event.rs:484-498](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L484-L498), [alacritty/src/event.rs:507-526](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L507-L526), [alacritty/src/window_context.rs:47-68](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/window_context.rs#L47-L68), [alacritty/src/event.rs:624-648](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L624-L648)

## Event Processing Flow

The event system's processing flow starts with the event loop in the main function and flows through several layers of handlers.

### Event Loop and Processor

The event processing begins in the `main.rs` file where an `EventLoop` is created and passed to a `Processor`. The processor is initialized with the application configuration and options, and then runs the event loop.

```mermaid
sequenceDiagram
    participant M as "Main"
    participant E as "EventLoop"
    participant P as "Processor"
    participant W as "WindowContext"
    participant A as "ActionContext"
    participant T as "Terminal"
    
    M->>E: create_event_loop()
    M->>P: new(config, options, event_loop)
    M->>P: run(event_loop)
    activate P
    
    E->>P: new_events()
    E->>P: window_event(window_id, event)
    E->>P: user_event(event)
    
    P->>W: handle_event(event)
    activate W
    W->>A: handle_event(event)
    activate A
    A->>T: process_input()
    A->>T: scroll()
    A->>T: write_to_pty()
    deactivate A
    W->>W: draw()
    deactivate W
    
    E->>P: about_to_wait()
    P->>P: scheduler.update()
    
    E->>P: exiting()
    deactivate P
```

Sources: [alacritty/src/main.rs:135-140](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/main.rs#L135-L140), [alacritty/src/event.rs:93-197](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L93-L197), [alacritty/src/event.rs:220-255](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L220-L255), [alacritty/src/window_context.rs:391-482](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/window_context.rs#L391-L482)

### Processor and Event Handling

The `Processor` serves as the main entry point for events. It manages a collection of window contexts and dispatches events to the appropriate window.

1. **Event Types** - The processor handles several types of events:
   - Window events (input, resize, close)
   - User events (custom events defined by Alacritty)
   - Terminal events (from PTY)
   - Timer events (cursor blinking, etc.)

2. **Event Dispatch** - Events are dispatched based on their target window:
   - Events with a specific window ID are sent to that window's context
   - Events without a window ID are broadcast to all windows

Sources: [alacritty/src/event.rs:220-456](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L220-L456)

## Window Context and Event Handling

The `WindowContext` represents a single terminal window and contains the terminal state, display, and event handling logic.

```mermaid
flowchart TD
    A["WindowContext.handle_event()"] --> B["Queue Event"]
    B --> C["Process Event Queue"]
    C --> D["Create ActionContext"]
    D --> E["Create InputProcessor"]
    E --> F["Process Each Event"]
    F --> G{"Event Type?"}
    
    G -->|"Key Press"| H["Process Key Input"]
    G -->|"Mouse Event"| I["Process Mouse Input"]
    G -->|"Window Resize"| J["Update Display Size"]
    G -->|"Focus Change"| K["Update Focus State"]
    G -->|"Config Change"| L["Update Config"]
    
    H --> M["Terminal Action"]
    I --> M
    M --> N["Update Terminal State"]
    N --> O["Request Redraw"]
    
    J --> O
    K --> O
    L --> O
```

Sources: [alacritty/src/window_context.rs:391-482](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/window_context.rs#L391-L482)

When an event is received by a window context, it is first queued up and then processed in batches. The window context creates an `ActionContext` which provides the interface for performing actions on the terminal, display, and other components.

## Action Context

The `ActionContext` is the interface through which events trigger changes to the terminal state, display, and other components.

```mermaid
classDiagram
    class ActionContext {
        +notifier: Notifier
        +terminal: Term<T>
        +clipboard: Clipboard
        +mouse: Mouse
        +touch: TouchPurpose
        +modifiers: Modifiers
        +display: Display
        +message_buffer: MessageBuffer
        +config: UiConfig
        +cursor_blink_timed_out: bool
        +event_proxy: EventLoopProxy<Event>
        +scheduler: Scheduler
        +search_state: SearchState
        +inline_search_state: InlineSearchState
        +dirty: bool
        +occluded: bool
        +preserve_title: bool
    }
    
    class InputProcessor {
        +context: ActionContext
        +handle_event()
        +process_key_bindings()
        +process_mouse_bindings()
        +search_next()
    }
    
    InputProcessor --> ActionContext : uses
```

Sources: [alacritty/src/event.rs:624-648](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L624-L648)

The `ActionContext` implements the `input::ActionContext` trait which defines methods for all the actions that can be triggered by input events, such as:

- Writing to the PTY
- Scrolling the terminal view
- Copying and pasting text
- Managing selections
- Updating the window
- Changing font size
- Handling search

Sources: [alacritty/src/event.rs:650-864](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L650-L864)

## Event Types

Alacritty defines several types of events that flow through the event system:

### Alacritty Event Types

```mermaid
classDiagram
    class Event {
        +window_id: Option<WindowId>
        +payload: EventType
    }
    
    class EventType {
        +Terminal(TerminalEvent)
        +ConfigReload(PathBuf)
        +Message(Message)
        +Scroll(Scroll)
        +CreateWindow(WindowOptions)
        +IpcConfig(IpcConfig)
        +BlinkCursor
        +BlinkCursorTimeout
        +SearchNext
        +Frame
    }
    
    class TerminalEvent {
        +Wakeup
        +Exit
        +CursorBlinkingChange
        +Title
        +ResetTitle
        +ClipboardStore
        +ClipboardLoad
        +PtyWrite
        +MouseCursorDirty
        +TextAreaSizeRequest
        +Resize
    }
    
    Event --> EventType
    EventType --> TerminalEvent
```

Sources: [alacritty/src/event.rs:484-526](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L484-L526)

Each event type corresponds to a specific action or state change in the terminal:

1. **Terminal Events** - Events related to the terminal state and PTY
2. **Config Reload** - Triggered when the configuration file changes
3. **Message** - Messages to display in the message bar
4. **Scroll** - Terminal scrolling events
5. **Create Window** - Request to create a new terminal window
6. **IPC Config** - Configuration changes via IPC
7. **BlinkCursor/BlinkCursorTimeout** - Cursor blinking events
8. **SearchNext** - Search functionality events
9. **Frame** - Display frame-related events

## Input Handling and Action Binding

A key part of the event system is mapping user input to actions. This is handled through key and mouse bindings that associate inputs with specific actions.

### Key and Mouse Binding Structure

```mermaid
classDiagram
    class Binding {
        +mods: ModifiersState
        +action: Action
        +mode: BindingMode
        +notmode: BindingMode
        +trigger: T
        +is_triggered_by()
    }
    
    class KeyBinding {
        +trigger: BindingKey
    }
    
    class MouseBinding {
        +trigger: MouseButton
    }
    
    class Action {
        +Esc(String)
        +Command(Program)
        +Hint(Rc<Hint>)
        +ViMotion(ViMotion)
        +Vi(ViAction)
        +Search(SearchAction)
        +Mouse(MouseAction)
        +Paste
        +Copy
        +CopySelection
        +PasteSelection
        +IncreaseFontSize
        +DecreaseFontSize
        +ResetFontSize
        +ScrollPageUp
        +ScrollPageDown
        +... (many more)
    }
    
    Binding <|-- KeyBinding
    Binding <|-- MouseBinding
    Binding --> Action
```

Sources: [alacritty/src/config/bindings.rs:25-86](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/config/bindings.rs#L25-L86), [alacritty/src/config/bindings.rs:88-252](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/config/bindings.rs#L88-L252)

When an input event is received, the `InputProcessor` checks if the input matches any defined bindings and executes the corresponding action.

## Search and Vi Mode Event Handling

Alacritty includes features for searching text and a Vi-like mode for navigation and selection, both of which have their own event handling:

### Search State

```mermaid
classDiagram
    class SearchState {
        +direction: Direction
        +history_index: Option<usize>
        +display_offset_delta: i32
        +origin: Point
        +focused_match: Option<Match>
        +history: VecDeque<String>
        +dfas: Option<RegexSearch>
        +regex()
        +direction()
        +focused_match()
        +dfas()
    }
    
    class InlineSearchState {
        +char_pending: bool
        +character: Option<char>
        +direction: Direction
        +stop_short: bool
    }
```

Sources: [alacritty/src/event.rs:528-622](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L528-L622)

These states are managed as part of the event system and affect how certain events are processed. For example, when in search mode, keyboard input is directed to the search interface rather than the terminal.

## Scheduler and Timed Events

The event system includes a scheduler for timed events like cursor blinking:

```mermaid
flowchart TD
    A["Scheduler"] --> B["Schedule Event"]
    B --> C["Create Timer"]
    C --> D["Store Timer"]
    A --> E["Update Timers"]
    E --> F{"Timer Expired?"}
    F -->|"Yes"| G["Send Event"]
    F -->|"No"| H["Calculate Next Deadline"]
    G --> I["Event Loop"]
    H --> I
```

Sources: [alacritty/src/event.rs:450-454](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L450-L454)

The scheduler allows events to be triggered after a delay or at regular intervals, which is used for features like cursor blinking and search delay.

## Event Processing Examples

To illustrate how the event system works in practice, here are some examples of common event flows:

### Keyboard Input Processing

```mermaid
sequenceDiagram
    participant U as "User"
    participant W as "Winit Event Loop"
    participant P as "Processor"
    participant WC as "WindowContext"
    participant A as "ActionContext"
    participant T as "Terminal"
    
    U->>W: Press 'A' Key
    W->>P: window_event(WindowEvent::KeyboardInput)
    P->>WC: handle_event(KeyboardInput)
    WC->>A: process_key_bindings()
    
    alt Matches Vi Mode Binding
        A->>A: handle_vi_motion()
    else Matches Normal Action
        A->>A: execute_action()
    else No Match
        A->>T: write_to_pty("a")
    end
    
    A->>WC: mark_dirty()
    WC->>W: request_redraw()
```

Sources: [alacritty/src/event.rs:240-274](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L240-L274), [alacritty/src/window_context.rs:391-463](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/window_context.rs#L391-L463)

### Configuration Reload

```mermaid
sequenceDiagram
    participant M as "Monitor"
    participant P as "Processor"
    participant E as "Event Loop"
    participant W as "WindowContext"
    
    M->>E: send_event(ConfigReload)
    E->>P: user_event(ConfigReload)
    P->>P: reload_config()
    
    loop For Each Window
        P->>W: update_config()
        W->>W: terminal.set_options()
        W->>W: display.update_config()
    end
```

Sources: [alacritty/src/event.rs:311-338](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/event.rs#L311-L338), [alacritty/src/window_context.rs:256-328](https://github.com/alacritty/alacritty/blob/a0c4dfe9/alacritty/src/window_context.rs#L256-L328)

## Summary

The Alacritty Event System is a comprehensive framework for handling user input, PTY output, window events, and internal state changes. It consists of:

1. An event processor (`Processor`) that dispatches events to windows
2. Window contexts (`WindowContext`) that process events for individual terminal windows
3. Action contexts (`ActionContext`) that provide interfaces for performing actions
4. Various event types representing different kinds of state changes
5. A binding system that maps user input to actions
6. A scheduler for timed events

Together, these components enable responsive terminal emulation with a rich set of features and a highly customizable user experience.